{% extends 'substitute/base.html' %}
<div></div>
{% block substitute-content %} {% if not error %}
<div></div>
{% for substitute in substitutes%}
<div class="col-md-4 border rounded mt-5">
  <div></div>
  <h3>
    {{substitute.name}} {% if request.user.is_authenticated %}<button
      class="fav btn btn-primary"
      value="{{substitute.id}}"
    >
      <i class="fas fa-heart"></i>
    </button>

    {% endif %}
  </h3>
  <div class="row border rounded">
    <div class="col-12">Nutriscore: {{substitute.product_nutriscore.name}}</div>
    <div class="col-12">Magasin: {{substitute.store}}</div>
  </div>
  <div class="row justify-content-center">
    <a href="{{substitute.url}}"
      ><img
        class="m-auto"
        src="{{substitute.image_url}}"
        alt="{{substitute.name}}"
        style="width: 10rem"
    /></a>
  </div>
</div>
{% endfor %} {% else %}
<p>{{error}}</p>

{% endif %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script>
  $(".fav").click(function () {
    event.preventDefault();

    alert("produit ajoutÃ©");
    let form = new FormData();

    form.append("fav", $(this).val());
    let csrfTokenValue = document.querySelector(
      "[name=csrfmiddlewaretoken]"
    ).value;
    let request = new Request("{% url 'substitute:add_fav' %}", {
      method: "POST",
      body: form,
      headers: { "X-CSRFToken": csrfTokenValue },
    });
    fetch(request)
      .then((response) => response.json())
      .then((result) => {
        let resultParagraph = document.querySelector("#operation");
        resultParagraph.innerHTML = result["operation_result"];
      });
  });

  document
    .querySelector("#fetch-call")
    .addEventListener("click", (event) => {});
</script>

{% endblock substitute-content %}
