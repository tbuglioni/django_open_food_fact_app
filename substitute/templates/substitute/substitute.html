{% extends 'base.html' %} {% block content %} {% if not error %}
<div>
  <div>
    <h1>Votre recherche</h1>
    <p>{{search}}</p>
    <p>{{products.name}}</p>
    <p>{{products.product_nutriscore.name}}</p>
  </div>

  {% for substitute in substitutes%}

  <div></div>
  <div>
    <a href="{{substitute.url}}" target="_blank">{{substitute.name}}</a>
    {{substitute.store}} Nutriscore : {{substitute.product_nutriscore.name}}
    <button class="fav" value="{{substitute.id}}">add to Favorite</button>
  </div>

  {% endfor %}
</div>
{% else %}
<p>{{error}}</p>

{% endif %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script>
  $(".fav").click(function () {
    event.preventDefault();

    alert("produit ajoutÃ©");
    let form = new FormData();

    form.append("fav", $(this).val());
    let csrfTokenValue = document.querySelector("[name=csrfmiddlewaretoken]")
      .value;
    let request = new Request("{% url 'substitute:add_fav' %}", {
      method: "POST",
      body: form,
      headers: { "X-CSRFToken": csrfTokenValue },
    });
    fetch(request)
      .then((response) => response.json())
      .then((result) => {
        let resultParagraph = document.querySelector("#operation");
        resultParagraph.innerHTML = result["operation_result"];
      });
  });

  document
    .querySelector("#fetch-call")
    .addEventListener("click", (event) => {});
</script>

{% endblock content %}
